<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Food Distribution — Baraka Community & Family Centre</title>
  <meta name="description" content="Weekly food support in partnership with FareShare, with dignity-first access for families and refugees in need."/>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="assets/site.css">
  <style>
    main.container { padding-top: 16px; }
    .wide-hero { margin: 12px 0 24px; }
    .fact { display:grid; grid-template-columns: 120px 1fr; gap:10px; align-items:start; }
    .fact b { color: var(--muted); }
    .activity-list { display:grid; grid-template-columns: repeat(2,1fr); gap:12px; }
    .activity-list li { background: var(--card); border:1px solid var(--card-border); border-radius:12px; padding:10px 12px; }
    .session-plan { display:grid; grid-template-columns: 1fr 3fr; gap:10px; }
    .session-plan div { background: var(--card); border:1px solid var(--card-border); border-radius:12px; padding:10px 12px; }
    @media (max-width: 900px){
      .activity-list { grid-template-columns: 1fr; }
      .session-plan { grid-template-columns: 1fr; }
    }
    /* Safety: slideshow essentials in case site.css fails */
    .slideshow{position:relative;border-radius:16px;border:1px solid var(--card-border, #d1e7dd);background:var(--card, #EAF7F1);overflow:hidden;aspect-ratio:16/9;min-height:320px}
    .slideshow .slides{position:relative;width:100%;height:100%}
    .slideshow .slide{position:absolute;inset:0;opacity:0;transition:opacity .5s ease-in-out}
    .slideshow .slide.active{opacity:1}
    .slideshow .slide img{width:100%;height:100%;object-fit:cover;display:block}
    .slideshow .caption{position:absolute;left:12px;bottom:12px;background:rgba(0,0,0,.45);color:#fff;padding:6px 10px;border-radius:8px;font-size:12px}
    .slideshow .nav{position:absolute;top:50%;transform:translateY(-50%);width:42px;height:42px;border-radius:999px;border:1px solid rgba(255,255,255,.6);background:rgba(0,0,0,.25);color:#fff;font-size:22px;font-weight:800;display:grid;place-items:center;cursor:pointer;z-index:2}
    .slideshow .nav.prev{left:10px}.slideshow .nav.next{right:10px}
    .slideshow .dots{position:absolute;left:0;right:0;bottom:10px;display:flex;justify-content:center;gap:8px;z-index:2}
    .slideshow .dot{width:8px;height:8px;border-radius:999px;background:rgba(255,255,255,.6);border:0;padding:0;cursor:pointer}
    .slideshow .dot.active{background:#fff}
  </style>
</head>
<body>

  <!-- HEADER -->
  <header class="site-header">
    <div class="container nav">
      <a class="logo" href="index.html">
        <img id="logo" src="assets/baraka-logo.png" alt="Baraka logo">
        <span id="siteName">Baraka Community & Family Centre</span>
      </a>
      <button class="menu-toggle" aria-expanded="false" aria-controls="site-menu">Menu</button>
      <nav id="site-menu" class="menu" aria-label="Main menu"></nav>
    </div>
  </header>

  <main class="container">
    <!-- TOP: Slideshow -->
    <section class="wide-hero" aria-label="Food Distribution photos">
      <div class="slideshow" id="fd-slideshow" aria-label="Food Distribution slideshow">
        <div class="slides"></div>
        <button class="nav prev" data-prev aria-label="Previous slide">‹</button>
        <button class="nav next" data-next aria-label="Next slide">›</button>
        <div class="dots"></div>
      </div>
    </section>

    <!-- Overview -->
    <section>
      <div class="kicker">Programmes</div>
      <h1 class="section-title">Food Distribution Service</h1>
      <p class="lead" id="fd-lead"></p>
      <div class="two" style="margin-top:12px">
        <div class="card">
          <h3>When & where</h3>
          <div class="fact"><b>Day</b><div id="fd-day"></div></div>
          <div class="fact"><b>Time</b><div id="fd-time"></div></div>
          <div class="fact"><b>Location</b><div id="fd-location"></div></div>
          <div class="fact"><b>Who for</b><div id="fd-who"></div></div>
          <div class="fact"><b>Cost</b><div id="fd-cost"></div></div>
          <div class="fact"><b>Register</b><div id="fd-register"></div></div>
        </div>
        <div class="card">
          <h3>How it works</h3>
          <ul class="activity-list" id="fd-activities"></ul>
          <p class="notice" id="fd-notes"></p>
        </div>
      </div>
    </section>

    <!-- Typical session/flow -->
    <section style="margin-top:18px">
      <div class="kicker">Typical flow</div>
      <h2 class="section-title">Dignity-first, welcoming & fair</h2>
      <div class="session-plan" id="fd-session-grid"></div>
    </section>

    <!-- CTA -->
    <section style="margin-top:18px">
      <div class="card">
        <h3 style="margin:0 0 8px">Questions or want to help?</h3>
        <p class="notice" id="fd-cta-note"></p>
        <div style="display:flex;gap:10px;flex-wrap:wrap">
          <a id="fd-cta-primary" class="btn" href="#">Request support</a>
          <a class="btn secondary" href="get-involved.html">Volunteer</a>
          <a class="pill" href="programmes.html">All programmes</a>
        </div>
      </div>
    </section>
  </main>

  <!-- FOOTER -->
  <footer class="footer">
    <div class="container" style="display:flex;flex-wrap:wrap;gap:12px;align-items:center;justify-content:space-between;">
      <div>© <span id="year"></span> <span id="footerName">Baraka Community & Family Centre</span> · All rights reserved.<br><span class="notice">Registered SCIO <span id="scio"></span></span></div>
      <div class="oscr"><img id="oscrBadge" src="assets/oscr-badge.jpg" alt="OSCR badge"/></div>
    </div>
  </footer>

  <!-- Page content (editable) -->
  <script id="food-distribution-content" type="application/json">
  {
    "lead": "Weekly food support in partnership with FareShare, prioritising families and refugees in need — delivered with dignity, privacy and care.",
    "when": {
      "day": "Weekly (see announcements/calendar)",
      "time": "Please check weekly slot in our updates",
      "location": "West Glasgow — exact venue shared on confirmation",
      "who": "Families and individuals in need (with referral/registration)",
      "cost": "Free",
      "register_label": "Email to request support",
      "register_href": "mailto:hello@baraka-centre.org?subject=Food%20Distribution%20request"
    },
    "activities": [
      "Welcoming check-in & sign-in",
      "Queue system with timed slots for dignity",
      "Fresh & ambient items (availability varies)",
      "Signposting and advice if needed"
    ],
    "notes": "Run by staff and volunteers. Supply varies week to week; we’ll always do our best to help.",
    "session_plan": [
      ["Before opening", "Delivery & sorting by volunteers"],
      ["Opening time", "Check-in, queue and timed slots"],
      ["During", "Collection support, signposting & advice"],
      ["Close", "Tidy up & stock check"]
    ],
    "cta_note": "If you need food support or can volunteer with loading/sorting/collection, please get in touch.",
    "cta_primary_label": "Request support",
    "cta_primary_href": "mailto:hello@baraka-centre.org?subject=Food%20Distribution%20request",
    "images": [],
    "fallback_image": { "src": "assets/Farashare_Food/50.jpg", "alt": "Food Distribution" }
  }
  </script>

  <!-- Shared helpers -->
  <script src="assets/site.js"></script>

  <!-- Page render -->
  <script>
    (function(){
      const ESC = (s)=>String(s??'').replace(/[&<>"]/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]));
      function parsePage(){ try{ return JSON.parse(document.getElementById('food-distribution-content').textContent||'{}'); }catch{ return {}; } }
      function checkImage(src){
        return new Promise(res=>{ const i=new Image(); i.onload=()=>res(true); i.onerror=()=>res(false); i.src=encodeURI(src); });
      }

      // Try BOTH possible folder spellings and BOTH .jpg/.jpeg
      async function discoverFareshareImages(){
        const out = [];
        const bases = ['assets/Fareshare_Food/', 'assets/Farashare_Food/']; // handles typo both ways
        const names = [];
        // You said: 51..58.jpeg, 59.jpeg, 60.jpeg
        for(let n=51;n<=60;n++){
          names.push(`$NUM.jpg`, `$NUM.jpeg`, `$NUM.JPG`, `$NUM.JPEG`.replace('$NUM', n)); // we'll replace below
        }
        for(let n=51;n<=60;n++){
          for(const base of bases){
            const candidates = [`${n}.jpg`, `${n}.jpeg`, `${n}.JPG`, `${n}.JPEG`];
            for(const file of candidates){
              const p = base + file;
              /* eslint-disable-next-line no-await-in-loop */
              if (await checkImage(p)) { out.push({ src:p, alt:`FareShare ${n}` }); break; }
            }
            if (out.length && out[out.length-1].src.endsWith(`${n}.jpg`) || out.length && out[out.length-1].src.endsWith(`${n}.jpeg`) || out.length && out[out.length-1].src.endsWith(`${n}.JPG`) || out.length && out[out.length-1].src.endsWith(`${n}.JPEG`)) {
              break; // found for this n in one base
            }
          }
        }
        return out;
      }

      function localInitSlideshow(rootId, images, {interval=4000}={}){
        const root=document.getElementById(rootId);
        if(!root||!images?.length) return;
        const slides=root.querySelectorAll('.slide');
        const dots=root.querySelectorAll('.dot');
        const prev=root.querySelector('[data-prev]'), next=root.querySelector('[data-next]');
        let idx=0, timer=null;
        const render=()=>{ slides.forEach((s,i)=>s.classList.toggle('active',i===idx)); dots.forEach((d,i)=>d.classList.toggle('active',i===idx)); };
        const go=n=>{ idx=(n+images.length)%images.length; render(); };
        const start=()=>{ stop(); timer=setInterval(()=>go(idx+1),interval); };
        const stop =()=>{ if(timer) clearInterval(timer); timer=null; };
        prev?.addEventListener('click',()=>{ go(idx-1); start(); });
        next?.addEventListener('click',()=>{ go(idx+1); start(); });
        dots.forEach((d,i)=>d.addEventListener('click',()=>{ idx=i; start(); }));
        root.addEventListener('mouseenter',stop);
        root.addEventListener('mouseleave',start);
        render(); start();
      }

      function ensureHeaderFooter(){
        const d = window.__SITE__ || {};
        (window.SITE?.applyBrand||(()=>{}))(d.site?.brand||{});
        (window.SITE?.buildHeader||(()=>{}))(d);
        (window.SITE?.buildFooter||(()=>{}))(d);
        const y=document.getElementById('year'); if(y) y.textContent=new Date().getFullYear();
        const menu = document.getElementById('site-menu');
        if (menu && !menu.children.length){
          const links=[{label:'Home',href:'index.html'},{label:'Programmes',href:'programmes.html'},{label:'Get involved',href:'get-involved.html'},{label:'Gallery',href:'gallery.html'},{label:'Contact',href:'contact.html'}];
          const here=(location.pathname.split('/').pop()||'').toLowerCase();
          menu.innerHTML = links.map(l=>`<a class="${here===l.href.toLowerCase()?'active':''}" href="${l.href}">${ESC(l.label)}</a>`).join('');
          const toggle=document.querySelector('.menu-toggle');
          toggle?.addEventListener('click',()=>{ const open=menu.classList.toggle('open'); toggle.setAttribute('aria-expanded',open?'true':'false'); toggle.textContent=open?'Close':'Menu'; });
        }
      }

      async function renderPage(){
        ensureHeaderFooter();
        const page = parsePage();

        // Lead & facts
        document.getElementById('fd-lead').textContent     = page.lead || 'Weekly food support in partnership with FareShare.';
        document.getElementById('fd-day').textContent      = page.when?.day || 'Weekly';
        document.getElementById('fd-time').textContent     = page.when?.time || 'Check announcements';
        document.getElementById('fd-location').textContent = page.when?.location || 'West Glasgow';
        document.getElementById('fd-who').textContent      = page.when?.who || 'Families/individuals in need';
        document.getElementById('fd-cost').textContent     = page.when?.cost || 'Free';
        document.getElementById('fd-register').innerHTML   = `<a class="btn" href="${ESC(page.when?.register_href || 'mailto:hello@baraka-centre.org')}">${ESC(page.when?.register_label || 'Request support')}</a>`;

        // Activities & notes
        const acts = page.activities || [];
        document.getElementById('fd-activities').innerHTML = acts.map(a=>`<li>${ESC(a)}</li>`).join('') || '<li>Queue with timed slots</li>';
        document.getElementById('fd-notes').textContent = page.notes || '';

        // Session flow
        const flow = page.session_plan || [];
        document.getElementById('fd-session-grid').innerHTML = flow.map(([t,what])=>`<div><b>${ESC(t)}</b></div><div>${ESC(what)}</div>`).join('');

        // CTA
        const ctaA = document.getElementById('fd-cta-primary');
        ctaA.textContent = page.cta_primary_label || 'Request support';
        ctaA.href = page.cta_primary_href || 'mailto:hello@baraka-centre.org';
        document.getElementById('fd-cta-note').textContent = page.cta_note || '';

        // Slideshow
        let imgs = Array.isArray(page.images) ? page.images.slice() : [];
        if (!imgs.length) imgs = await discoverFareshareImages();
        if (!imgs.length && page.fallback_image) imgs = [page.fallback_image];

        const rootId='fd-slideshow';
        const slidesEl=document.querySelector('#'+rootId+' .slides');
        const dotsEl=document.querySelector('#'+rootId+' .dots');

        if (imgs.length && slidesEl && dotsEl){
          const slidesHtml = imgs.map((g,i)=>`
            <div class="slide ${i===0?'active':''}">
              <img src="${encodeURI(g.src)}" alt="${ESC(g.alt||'Food distribution')}" loading="lazy">
              ${g.caption ? `<div class="caption">${ESC(g.caption)}</div>` : ''}
            </div>`).join('');
          const dotsHtml = imgs.map((_,i)=>`<button class="dot ${i===0?'active':''}" aria-label="Go to slide ${i+1}"></button>`).join('');
          slidesEl.innerHTML = slidesHtml;
          dotsEl.innerHTML   = dotsHtml;
          (window.SITE?.initSlideshow || localInitSlideshow)(rootId, imgs, { interval: 4000 });
        } else if (slidesEl){
          slidesEl.innerHTML = `<div class="slide active"><img src="${encodeURI(page.fallback_image?.src || 'assets/Farashare_Food/50.jpg')}" alt="Food Distribution" loading="lazy"></div>`;
        }
      }

      window.addEventListener('DOMContentLoaded', renderPage);
      document.addEventListener('site:loaded', renderPage, { once:true });
      setTimeout(()=>{ if(!window.__SITE__) renderPage(); }, 900);
    })();
  </script>
</body>
</html>
